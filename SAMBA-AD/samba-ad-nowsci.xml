<?xml version="1.0"?>
<Container version="2">
  <Name>Samba-AD-DC</Name>
  <Repository>nowsci/samba-domain</Repository>
  <Registry>https://hub.docker.com/r/nowsci/samba-domain</Registry>
  <Network>Custom: macvlan-bridge</Network>
  <MyIP/>
  <Shell>bash</Shell>
  <Privileged>true</Privileged>
  <Support>https://github.com/Fmstrat/samba-domain</Support>
  <Project>https://nowsci.com/samba-domain/</Project>
  <Overview>Samba Active Directory Domain Controller using MACVLAN networking for dedicated IP address and zero port conflicts.

MACVLAN PREREQUISITES:
• Create MACVLAN network first: Settings → Docker → Custom Networks → Add Network
• Network Name: macvlan-bridge (or your chosen name)
• Network Type: macvlan
• Parent Interface: eth0 (or your network interface)
• Subnet: 192.168.1.0/24 (match your network)
• Gateway: 192.168.1.1 (your router IP)
• IP Range: 192.168.1.200/28 (available IPs for containers)

NETWORK SETUP REQUIRED:
1. Go to Unraid Settings → Docker → Enable Docker: Off
2. Settings → Network Settings → Create custom network
3. Configure MACVLAN with your network settings
4. Turn Docker back on
5. Container will get its own IP address (no port mapping needed)

ADVANTAGES:
• No port conflicts with any other services
• Container appears as dedicated server on network
• Better performance for network services
• Simplified firewall and network configuration</Overview>
  <Category>Network:Management Security:Authentication</Category>
  <WebUI/>
  <TemplateURL/>
  <Icon>https://raw.githubusercontent.com/unraid/docker-templates/master/templates/icons/samba.png</Icon>
  <ExtraParams>--restart=unless-stopped</ExtraParams>
  <PostArgs/>
  <CPUset/>
  <DateInstalled></DateInstalled>
  <DonateText/>
  <DonateLink/>
  <Requires>MACVLAN NETWORK SETUP REQUIRED:

STEP 1 - CREATE MACVLAN NETWORK:
Go to: Settings → Docker → Custom Networks → Add Network
• Network Name: macvlan-bridge
• Network Type: macvlan
• Network Driver: macvlan
• Parent Interface: eth0 (or br0, your main interface)
• Subnet: 192.168.1.0/24 (match your LAN subnet)
• Gateway: 192.168.1.1 (your router/gateway IP)
• IP Range: 192.168.1.200/28 (16 IPs: .200-.215 for containers)

STEP 2 - NETWORK REQUIREMENTS:
• Available IP addresses in your LAN range
• Router/switch supporting multiple MACs per port (most modern equipment)
• No DHCP conflicts with chosen IP range
• Firewall rules allowing container IP (if applicable)

STEP 3 - CHOOSE CONTAINER IP:
Select unused IP in your network range (e.g., 192.168.1.200)
This IP will be dedicated to this container
Configure HOSTIP environment variable to match this IP

STEP 4 - HOST ACCESS CONFIGURATION (Optional):
To access container from Unraid host, create route:
ip route add [CONTAINER_IP]/32 dev [MACVLAN_INTERFACE]

VERIFICATION COMMANDS:
docker network ls (should show macvlan-bridge)
docker network inspect macvlan-bridge
ping [CONTAINER_IP] (from another device)

NO PORT MAPPING NEEDED - Container uses all standard ports on its own IP</Requires>
  
  <!-- NO PORT MAPPINGS - MACVLAN uses dedicated IP -->
  <!-- All standard ports (53, 88, 135, 137-139, 389, 445, 464, etc.) available on container IP -->
  
  <!-- MACVLAN NETWORK CONFIGURATION -->
  <Config Name="Container IP Address" Target="CONTAINER_IP" Default="" Mode="" Description="REQUIRED: Dedicated IP for container (e.g., 192.168.1.200). Must be in MACVLAN network range and not used by other devices. This becomes the container's network identity." Type="Variable" Display="always" Required="true" Mask="false"></Config>
  
  <!-- ESSENTIAL DOMAIN CONFIGURATION -->
  <Config Name="Domain Name" Target="DOMAIN" Default="" Mode="" Description="REQUIRED: Domain FQDN (e.g., example.com, CORP.EXAMPLE.COM). Choose carefully - difficult to change later." Type="Variable" Display="always" Required="true" Mask="false"></Config>
  <Config Name="Domain Admin Password" Target="DOMAINPASS" Default="" Mode="" Description="REQUIRED: Strong Administrator password. Minimum 12+ characters with complexity. Document securely." Type="Variable" Display="always" Required="true" Mask="true"></Config>
  <Config Name="Host IP Address" Target="HOSTIP" Default="" Mode="" Description="REQUIRED: MUST MATCH Container IP Address above. This tells Samba what IP to advertise. Example: 192.168.1.200" Type="Variable" Display="always" Required="true" Mask="false"></Config>
  <Config Name="DNS Forwarder" Target="DNSFORWARDER" Default="" Mode="" Description="RECOMMENDED: DNS server for external queries (usually router IP like 192.168.1.1). Required for internet name resolution." Type="Variable" Display="always" Required="false" Mask="false"></Config>
  
  <!-- DOMAIN TOPOLOGY -->
  <Config Name="Join Existing Domain" Target="JOIN" Default="false" Mode="" Description="false = Create NEW domain (typical). true = Join EXISTING domain as additional DC." Type="Variable" Display="always" Required="false" Mask="false">false</Config>
  <Config Name="Join Site" Target="JOINSITE" Default="" Mode="" Description="ADVANCED: AD Site name when joining existing domain. Leave empty for default site." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  <Config Name="Multi-Site VPN" Target="MULTISITE" Default="false" Mode="" Description="ADVANCED: Enable OpenVPN for multi-site replication. Requires VPN configuration." Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>
  
  <!-- ADVANCED DOMAIN SETTINGS -->
  <Config Name="Domain DN" Target="DOMAIN_DC" Default="" Mode="" Description="OPTIONAL: Domain DN format. Auto-generated from DOMAIN if empty." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  <Config Name="Domain Email" Target="DOMAIN_EMAIL" Default="" Mode="" Description="OPTIONAL: Email domain for user accounts. Different from AD domain." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  <Config Name="DC Hostname" Target="HOSTNAME" Default="" Mode="" Description="OPTIONAL: Domain controller hostname. Auto-generated if empty." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  
  <!-- SECURITY SETTINGS -->
  <Config Name="Insecure LDAP" Target="INSECURELDAP" Default="false" Mode="" Description="SECURITY: false = Require encrypted LDAP (recommended). true = Allow unencrypted LDAP." Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>
  <Config Name="No Password Complexity" Target="NOCOMPLEXITY" Default="false" Mode="" Description="SECURITY: false = Enforce password complexity (recommended). true = Disable complexity." Type="Variable" Display="advanced" Required="false" Mask="false">false</Config>
  
  <!-- NETWORK SETTINGS -->
  <Config Name="Multicast DNS" Target="MULTICASTDNS" Default="yes" Mode="" Description="Enable multicast DNS for service discovery. Recommended for mixed environments." Type="Variable" Display="advanced" Required="false" Mask="false">yes</Config>
  <Config Name="NetBIOS Name" Target="HOSTNETBIOS" Default="" Mode="" Description="OPTIONAL: NetBIOS name for DC. Auto-generated if empty." Type="Variable" Display="advanced" Required="false" Mask="false"></Config>
  
  <!-- LOGGING -->
  <Config Name="Log Level" Target="LOGLEVEL" Default="1" Mode="" Description="Samba log verbosity: 0=errors, 1=minimal (recommended), 3=detailed, 10=debug." Type="Variable" Display="advanced" Required="false" Mask="false">1</Config>
  
  <!-- TIME SYNC -->
  <Config Name="NTP Server" Target="NTPSERVER" Default="pool.ntp.org" Mode="" Description="NTP server for internal time synchronization. Critical for Kerberos operation." Type="Variable" Display="advanced" Required="false" Mask="false">pool.ntp.org</Config>
  <Config Name="Timezone" Target="TZ" Default="America/Denver" Mode="" Description="Container timezone. Should match Unraid host timezone." Type="Variable" Display="advanced" Required="false" Mask="false">America/Denver</Config>
  
  <!-- VOLUME MAPPINGS -->
  <Config Name="Samba Data" Target="/var/lib/samba" Default="/mnt/user/appdata/samba-ad/data" Mode="rw" Description="CRITICAL: Samba database and domain state. Must be persistent and backed up." Type="Path" Display="always" Required="true" Mask="false">/mnt/user/appdata/samba-ad/data</Config>
  <Config Name="Samba Config" Target="/etc/samba/external" Default="/mnt/user/appdata/samba-ad/config" Mode="rw" Description="CRITICAL: Samba configuration files. Persist across updates." Type="Path" Display="always" Required="true" Mask="false">/mnt/user/appdata/samba-ad/config</Config>
  <Config Name="System Timezone" Target="/etc/localtime" Default="/etc/localtime" Mode="ro" Description="System timezone synchronization with host." Type="Path" Display="advanced" Required="false" Mask="false">/etc/localtime</Config>
  <Config Name="OpenVPN Config" Target="/docker.ovpn" Default="/mnt/user/appdata/samba-ad/openvpn/docker.ovpn" Mode="ro" Description="MULTI-SITE ONLY: OpenVPN configuration for site-to-site replication." Type="Path" Display="advanced" Required="false" Mask="false">/mnt/user/appdata/samba-ad/openvpn/docker.ovpn</Config>
  <Config Name="VPN Credentials" Target="/credentials" Default="/mnt/user/appdata/samba-ad/openvpn/credentials" Mode="ro" Description="MULTI-SITE ONLY: VPN authentication credentials." Type="Path" Display="advanced" Required="false" Mask="false">/mnt/user/appdata/samba-ad/openvpn/credentials</Config>
  <Config Name="File Storage" Target="/storage" Default="/mnt/user/shares/samba-storage" Mode="rw" Description="OPTIONAL: File sharing storage. Configure in smb.conf post-deployment." Type="Path" Display="advanced" Required="false" Mask="false">/mnt/user/shares/samba-storage</Config>
</Container>
